---
import { imageUrlFor } from '../../lib/sanityClient';
import type { ClientLogo } from '../../lib/sanity';
import '@splidejs/splide/css';

interface Props {
    clientLogos: ClientLogo[];
}

const { clientLogos = [] } = Astro.props;

// Validar que haya logos para mostrar
if (!clientLogos || clientLogos.length === 0) {
    return null;
}
---

<section class="py-16 bg-gray-50 overflow-hidden">
    <div class="container mx-auto px-4">
        <h2 class="text-4xl font-bold text-center mb-12">Conf√≠an en Nosotros</h2>
        <div id="clients-carousel" class="splide" aria-label="Carrusel de logos de clientes">
            <div class="splide__track">
                <ul class="splide__list">
                    {clientLogos.map(logo => {
                        let logoUrl = '';
                        try {
                            logoUrl = imageUrlFor(logo.logo).height(60).url();
                        } catch (error) {
                            console.error('Error generating client logo URL:', error);
                            return null;
                        }
                        
                        return (
                            <li class="splide__slide flex items-center justify-center">
                                <img 
                                    src={logoUrl} 
                                    alt={logo.name || 'Logo de cliente'} 
                                    class="h-14 w-auto object-contain mx-8" 
                                    loading="lazy"
                                />
                            </li>
                        );
                    })}
                </ul>
            </div>
        </div>
    </div>
</section>

<script>
    import Splide from '@splidejs/splide';
    import { AutoScroll } from '@splidejs/splide-extension-auto-scroll';

    // Solo inicializar si el elemento existe
    const carousel = document.getElementById('clients-carousel');
    if (carousel) {
        document.addEventListener('DOMContentLoaded', () => {
            const splide = new Splide('#clients-carousel', {
                type   : 'loop',
                drag   : false,
                focus  : 'center',
                perPage: 5,
                arrows: false,
                pagination: false,
                autoScroll: {
                    speed: 1,
                    pauseOnHover: true,
                },
                breakpoints: {
                    768: {
                        perPage: 3,
                    },
                    640: {
                        perPage: 2,
                    }
                }
            });

            splide.mount({ AutoScroll });
        });
    }
</script> 